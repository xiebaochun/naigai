"use strict";var actid="h5cyAct";window.Api={doAjax:function(e,i,t){return new Promise(function(t,n){$.ajax({url:i,type:"POST",dataType:"json",data:e,success:function(e){t(e)},error:function(e){n(e)}})})}};var durTime=300,w=window.innerWidth*window.devicePixelRatio,h=window.innerHeight*window.devicePixelRatio,BaseState={asw:function(e,t,n,i,a){var o=this.add.sprite(e,t,n);return o.anchor.set(.5),a?this.setSize(o,i/100*h,!0):this.setSize(o,i/100*w,!1),o},as:function(e,t,n){this.game.width;return this.add.sprite(e,t,n)},setSize:function(e,t,n){if(n){var i=t/e.height;e.height=t,e.width=e.width*i}else{i=t/e.width;e.width=t,e.height=e.height*i}},setFull:function(e){e.width=w,e.height=h},shake:function(){this.game.camera.shake(.005,300)},fromLeft:function(e,t,n){var i=n||durTime;this.add.tween(e).from({x:-this.game.width/2},i,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},toLeft:function(e,t,n){this.add.tween(e).to({x:-this.game.width/2},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},fromRight:function(e,t,n){var i=n||durTime;this.add.tween(e).from({x:1.5*this.game.width},i,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},fromFlash:function(e,t){this.add.tween(e).from({alpha:0},100,Phaser.Easing.Linear.In,!0,0,5,!0).onComplete.add(function(){t()})},toRight:function(e,t,n){this.add.tween(e).to({x:1.5*this.game.width},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},fromTop:function(e,t,n){var i=n||durTime;this.add.tween(e).from({y:.4*-this.game.height},i,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},toTop:function(e,t,n){this.add.tween(e).to({y:.4*-this.game.height},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},fromBottom:function(e,t,n){this.add.tween(e).from({y:1.4*this.game.height},n,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t&&t()})},toBottom:function(e,t,n){this.add.tween(e).to({y:1.4*this.game.height},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},fromZoomMax:function(e,t,n){this.add.tween(e).from({width:4.2*e.width,height:4.2*e.height},n,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t&&t()})},fromZoomMax2:function(e,t){this.add.tween(e).from({width:10.2*e.width,height:10.2*e.height,alpha:.3},250,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t&&t()})},fromZoomMin:function(e,t,n){this.add.tween(e).from({width:.02*e.width,height:.02*e.height},n,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t&&t()})},fromZoomMin2:function(t,n,e){this.add.tween(t).from({width:.02*t.width,height:.02*t.height},500,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){var e=setTimeout(function(){t.destroy(),n&&n(),clearTimeout(e)},500)})},fromAlpha:function(e,t){this.add.tween(e).from({alpha:0},durTime,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t&&t()})},toAlpha:function(e,t,n){this.add.tween(e).to({alpha:0},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},toZoomMin:function(e,t,n){this.add.tween(e).to({width:.1*e.width,height:.1*e.height,alpha:0},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},toZoomMin2:function(e,t,n){this.add.tween(e).to({width:.1*e.width,height:.1*e.height,alpha:0},500,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},toZoomMax:function(e,t,n){this.add.tween(e).to({width:5.1*e.width,height:5.1*e.height,alpha:0},durTime,Phaser.Easing.Linear.In,!0,t,0,!1).onComplete.add(function(){e.destroy(),n&&n()})},dangling:function(e,t){t?this.add.tween(e).to({x:e.x+10},1e3,Phaser.Easing.Linear.In,!0,0,1e4,!0):this.add.tween(e).to({y:e.y+10},1e3,Phaser.Easing.Linear.In,!0,0,1e4,!0)},zoomandmax:function(e){this.add.tween(e).to({width:1.08*e.width,height:1.08*e.height},400,Phaser.Easing.Linear.In,!0,0,1e4,!0)},phoneValidate:function(e){return!!/^1(3|4|5|7|8)\d{9}$/.test(e)},addMask:function(e){var t=this.add.graphics();return t.beginFill(0,e),t.drawRect(0,0,w,h),t.endFill(),t},changeArr:function(e){return e.sort(function(){return.5-Math.random()})}},Boot=Object.assign({},BaseState,{init:function(){console.log(this,game.game),this.game.device.desktop||(this.game.input.maxPointers=5,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.forceOrientation(!1,!0)),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},preload:function(){this.game.load.crossOrigin=!0},create:function(){this.game.state.start("Preloader")}}),Preloader=Object.assign({},BaseState,{init:function(){},preload:function(){var e=this,t=window.baseURI;this.load.crossOrigin=!0,this.load.image("logo",t+"logo.png"),this.load.image("mh",t+"mh.png"),this.load.atlasXML("spObj",baseURI+"sp.png",baseURI+"sp.xml"),this.load.atlasXML("iO",baseURI+"i.png",baseURI+"i.xml"),this.load.audio("gameMusic",baseURI+"game.mp3"),this.load.audio("ddMusic",baseURI+"dd.mp3"),this.load.onFileComplete.add(function(e){document.getElementById("loadingText").innerHTML=e+"%"}),this.load.onLoadComplete.add(function(){document.getElementById("loading").style.display="none",e.state.start("State1")})},create:function(){}}),State1=Object.assign({},BaseState,{init:function(){console.log("State1")},preload:function(){},create:function(){var i=this,a=!1,e=this.asw(.025*w,.025*h,"logo",15),o=null,s=!0,d=!1;e.anchor.set(0,0);var t,n=game.add.emitter(game.world.centerX,game.world.centerY,250);n.makeParticles("iO",[0,1]),n.minParticleSpeed.setTo(-500,-500),n.maxParticleSpeed.setTo(500,500),n.minParticleScale=.1,n.maxParticleScale=.6,n.gravity=0,n.start(!1,2e3,10),t=document.getElementById("nickid").value,window.socketInstant=io.connect("ws://"+window.scoketIp+"?openid="+t,{path:"/"}),window.socketInstant.on("error",function(e){window.location.reload()}),window.socketInstant.on("disconnect",function(e){window.location.reload()}),window.socketInstant.on("connect",function(){document.getElementById("nickid").value,window.socketInstant.emit("c_login",{openId:document.getElementById("nickid").value,nickname:document.getElementById("nickname").value,headimg:document.getElementById("nickpic").value})});i=this;function r(e){window.socketInstant.emit("c_progress",{progress:50*e})}function c(){var e=document.getElementById("nickid").value,t=50*window.peopleNum*.01;window.socketInstant.emit("c_add",{openId:e,points:t})}window.socketInstant.on("s_start",function(e){console.log("s_start"),console.log(e),n.destroy(),$(".page1").hide(),$(".page2").show()}),window.socketInstant.on("s_status",function(e){1==e.status&&(n.destroy(),$(".page1").hide(),$(".page2").show())}),window.socketInstant.on("s_get_all_stand",function(e){console.log("s_get_all_stand"),console.log(e),window.peopleNum!=e.total&&r(e.total),window.maxData=e.progress,window.peopleNum=e.total,$("#numP").html(e.total)}),window.socketInstant.on("s_add",function(e){console.log("s_add"),console.log(e)}),window.socketInstant.on("s_someOneAdd",function(e){console.log("s_someOneAdd"),console.log(e);var t=e.allopints,n=parseInt(t/window.maxData*100);game.time.events.remove(o),console.log("摇数："+n),0==a&&($(".page2 .runGif").attr("src",window.baseURI+"runGif.gif"),a=!0),80<=n&&1==s&&(console.log(1254),s=!1,function(){game.time.events.repeat(1*Phaser.Timer.SECOND,1e7,c,this)}()),100<=n&&0==d?(d=!0,n=100,game.time.events.removeAll(),$(".page2 .runGif").css({left:"95%"}),$(".page2 .run").css({left:"93%"}),$(".page2 .runGif").attr("src",window.baseURI+"end.gif"),setTimeout(function(){$(".page2").hide(),i.state.start("State2"),window.socketInstant.removeAllListeners()},500)):(100<=n&&(n=100),$(".page2 p").css({width:n+"%"}),$(".page2 h2").html(n+"%"),$(".page2 .run").css({left:n+"%"}),$(".page2 .runGif").css({left:n+"%"})),o=game.time.events.add(1.2*Phaser.Timer.SECOND,function(){a=!1,$(".page2 .runGif").attr("src",window.baseURI+"stopGif.gif")})}),window.socketInstant.on("s_login",function(e){}),window.socketInstant.on("s_people",function(e){window.peopleNum!=e.total&&r(e.total),window.maxData=e.progress,window.peopleNum=e.total,$("#numP").html(e.total)})}}),State2=Object.assign({},BaseState,{init:function(){console.log("State2")},preload:function(){},create:function(){var t=this,n=[.1,.9,.6,.8,.2,.5],i=0,a=0;this.asw(.025*w,.025*h,"logo",15).anchor.set(0,0);game.add.group();var o=this.asw(game.world.centerX,.4*h,"mh",50);function s(){var e=game.add.sprite(game.width*n[i],0,"spObj",game.rnd.integerInRange(0,3));t.setSize(e,.2*game.height,!1),5<++i&&(i=0),e.anchor.set(.5),game.add.tween(e).to({y:1.2*game.height},2e3,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){e.destroy()}),e.inputEnabled=!1,e.events.onInputDown.add(function(){a++,$("#score").text(a),e.inputEnabled=!1,e.destroy()})}o.anchor.set(.5),game.add.tween(o).to({angle:10},100,Phaser.Easing.Linear.In,!0,0,10,!0).onComplete.add(function(){game.add.tween(o).to({width:1.3*o.width,height:1.3*o.height},200,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){o.destroy(),$("#gameContainer").css({"z-index":"99"});var e=game.add.emitter(game.world.centerX,game.world.centerY,50);e.makeParticles("mh"),e.minParticleSpeed.setTo(-1e3,-1e3),e.maxParticleSpeed.setTo(1e3,1e3),e.minParticleScale=.15,e.maxParticleScale=.15,e.gravity=10,e.start(!0,2e3,null,1e3),setTimeout(function(){setTimeout(function(){e.destroy()},1e3),setTimeout(function(){window.socketInstant.emit("c_end",{openId:document.getElementById("nickid").value,nickname:document.getElementById("nickname").value,headimg:"http://qn.kiis.cn/003b3899-c6f7-42a1-891a-2c1be0de9736.jpg"})},3e3),game.time.events.repeat(.2*Phaser.Timer.SECOND,1e5,s,this)},1500)})})}}),State3=Object.assign({},BaseState,{init:function(){console.log("init")},preload:function(){},create:function(){var e=this;console.log(Object);var t=this.asw(w/2,h/2,"logo",50);this.add.tween(t).from({alpha:0},500,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){e.dangling(t)}),console.log("create")}}),State4=Object.assign({},BaseState,{init:function(){console.log("init")},preload:function(){},create:function(){var e=this;console.log(Object);var t=this.asw(w/2,h/2,"logo",50);this.add.tween(t).from({alpha:0},500,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){e.dangling(t)}),console.log("create")}}),State5=Object.assign({},BaseState,{init:function(){},preload:function(){},create:function(){}});